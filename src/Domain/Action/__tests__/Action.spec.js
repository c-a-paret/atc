import {Altitude, Heading, HoldingPattern, Landing, Speed, Waypoint} from "../Action";
import {Aeroplane} from "../../Aeroplane/Aeroplane";
import {GameMap} from "../../GameMap/GameMap";
import {MAX_ALTITUDE, MIN_ALTITUDE} from "../../../config/constants";

const testGameMap = () => {
    return new GameMap({
        features: {
            runways: [{
                start: {
                    label: "9L", heading: 90, altitude: 0, landingZone: {
                        x: 510, y: 500,
                    }, ILS: {
                        innerMarker: {
                            x: 500, y: 500,
                        }, outerMarker: {
                            x: 280, y: 500,
                        }
                    }
                }, end: {
                    label: "27R", heading: 270, altitude: 0, landingZone: {
                        x: 490, y: 500,
                    }, ILS: {
                        innerMarker: {
                            x: 500, y: 550,
                        }, outerMarker: {
                            x: 720, y: 550,
                        }
                    }
                }
            }], waypoints: [{type: "VOR", id: "LAM", name: "Lambourne", x: 500, y: 500},]
        }
    })
}

describe("Speed", () => {
    test("Creates speed action with decreasing speed", () => {
        let weight = 3;
        let currentSpeed = 300;
        let desiredSpeed = 290;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, currentSpeed, 90, 5000, weight)

        const action = new Speed({}, aeroplane, desiredSpeed)

        expect(aeroplane.speed).toBe(300)
        action.apply()
        expect(aeroplane.speed).toBe(299)
        action.apply()
        expect(aeroplane.speed).toBe(298)
    })

    test("Creates speed action with increasing speed", () => {
        let weight = 3;
        let currentSpeed = 295;
        let desiredSpeed = 304;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, currentSpeed, 90, 5000, weight)

        const action = new Speed({}, aeroplane, desiredSpeed)

        expect(aeroplane.speed).toBe(295)
        action.apply()
        expect(aeroplane.speed).toBe(296)
        action.apply()
        expect(aeroplane.speed).toBe(297)
    })

    test("Is not valid if the target speed is below 0", () => {
        let desiredSpeed = -12;

        expect(new Speed({}, {speed: 200}, desiredSpeed).isValid()).toBeFalsy()
    })

    test("Is not valid if the target speed is same as current speed", () => {
        let desiredSpeed = 200;

        expect(new Speed({}, {speed: 200}, desiredSpeed).isValid()).toBeFalsy()
    })

    test("Is not valid if the target speed is lower than the minimum speed", () => {
        let desiredSpeed = 10;

        expect(new Speed({}, {speed: 200}, desiredSpeed).isValid()).toBeFalsy()
    })
})

describe("Heading", () => {
    test.each`
    startHeading | targetHeading | direction 
    ${0} | ${10} | ${'GT'}
    ${1} | ${11} | ${'GT'}
    ${2} | ${12} | ${'GT'}
    ${3} | ${13} | ${'GT'}
    ${4} | ${14} | ${'GT'}
    ${5} | ${15} | ${'GT'}
    ${6} | ${16} | ${'GT'}
    ${7} | ${17} | ${'GT'}
    ${8} | ${18} | ${'GT'}
    ${9} | ${19} | ${'GT'}
    ${10} | ${20} | ${'GT'}
    ${11} | ${21} | ${'GT'}
    ${12} | ${22} | ${'GT'}
    ${13} | ${23} | ${'GT'}
    ${14} | ${24} | ${'GT'}
    ${15} | ${25} | ${'GT'}
    ${16} | ${26} | ${'GT'}
    ${17} | ${27} | ${'GT'}
    ${18} | ${28} | ${'GT'}
    ${19} | ${29} | ${'GT'}
    ${20} | ${30} | ${'GT'}
    ${21} | ${31} | ${'GT'}
    ${22} | ${32} | ${'GT'}
    ${23} | ${33} | ${'GT'}
    ${24} | ${34} | ${'GT'}
    ${25} | ${35} | ${'GT'}
    ${26} | ${36} | ${'GT'}
    ${27} | ${37} | ${'GT'}
    ${28} | ${38} | ${'GT'}
    ${29} | ${39} | ${'GT'}
    ${30} | ${40} | ${'GT'}
    ${31} | ${41} | ${'GT'}
    ${32} | ${42} | ${'GT'}
    ${33} | ${43} | ${'GT'}
    ${34} | ${44} | ${'GT'}
    ${35} | ${45} | ${'GT'}
    ${36} | ${46} | ${'GT'}
    ${37} | ${47} | ${'GT'}
    ${38} | ${48} | ${'GT'}
    ${39} | ${49} | ${'GT'}
    ${40} | ${50} | ${'GT'}
    ${41} | ${51} | ${'GT'}
    ${42} | ${52} | ${'GT'}
    ${43} | ${53} | ${'GT'}
    ${44} | ${54} | ${'GT'}
    ${45} | ${55} | ${'GT'}
    ${46} | ${56} | ${'GT'}
    ${47} | ${57} | ${'GT'}
    ${48} | ${58} | ${'GT'}
    ${49} | ${59} | ${'GT'}
    ${50} | ${60} | ${'GT'}
    ${51} | ${61} | ${'GT'}
    ${52} | ${62} | ${'GT'}
    ${53} | ${63} | ${'GT'}
    ${54} | ${64} | ${'GT'}
    ${55} | ${65} | ${'GT'}
    ${56} | ${66} | ${'GT'}
    ${57} | ${67} | ${'GT'}
    ${58} | ${68} | ${'GT'}
    ${59} | ${69} | ${'GT'}
    ${60} | ${70} | ${'GT'}
    ${61} | ${71} | ${'GT'}
    ${62} | ${72} | ${'GT'}
    ${63} | ${73} | ${'GT'}
    ${64} | ${74} | ${'GT'}
    ${65} | ${75} | ${'GT'}
    ${66} | ${76} | ${'GT'}
    ${67} | ${77} | ${'GT'}
    ${68} | ${78} | ${'GT'}
    ${69} | ${79} | ${'GT'}
    ${70} | ${80} | ${'GT'}
    ${71} | ${81} | ${'GT'}
    ${72} | ${82} | ${'GT'}
    ${73} | ${83} | ${'GT'}
    ${74} | ${84} | ${'GT'}
    ${75} | ${85} | ${'GT'}
    ${76} | ${86} | ${'GT'}
    ${77} | ${87} | ${'GT'}
    ${78} | ${88} | ${'GT'}
    ${79} | ${89} | ${'GT'}
    ${80} | ${90} | ${'GT'}
    ${81} | ${91} | ${'GT'}
    ${82} | ${92} | ${'GT'}
    ${83} | ${93} | ${'GT'}
    ${84} | ${94} | ${'GT'}
    ${85} | ${95} | ${'GT'}
    ${86} | ${96} | ${'GT'}
    ${87} | ${97} | ${'GT'}
    ${88} | ${98} | ${'GT'}
    ${89} | ${99} | ${'GT'}
    ${90} | ${100} | ${'GT'}
    ${91} | ${101} | ${'GT'}
    ${92} | ${102} | ${'GT'}
    ${93} | ${103} | ${'GT'}
    ${94} | ${104} | ${'GT'}
    ${95} | ${105} | ${'GT'}
    ${96} | ${106} | ${'GT'}
    ${97} | ${107} | ${'GT'}
    ${98} | ${108} | ${'GT'}
    ${99} | ${109} | ${'GT'}
    ${100} | ${110} | ${'GT'}
    ${101} | ${111} | ${'GT'}
    ${102} | ${112} | ${'GT'}
    ${103} | ${113} | ${'GT'}
    ${104} | ${114} | ${'GT'}
    ${105} | ${115} | ${'GT'}
    ${106} | ${116} | ${'GT'}
    ${107} | ${117} | ${'GT'}
    ${108} | ${118} | ${'GT'}
    ${109} | ${119} | ${'GT'}
    ${110} | ${120} | ${'GT'}
    ${111} | ${121} | ${'GT'}
    ${112} | ${122} | ${'GT'}
    ${113} | ${123} | ${'GT'}
    ${114} | ${124} | ${'GT'}
    ${115} | ${125} | ${'GT'}
    ${116} | ${126} | ${'GT'}
    ${117} | ${127} | ${'GT'}
    ${118} | ${128} | ${'GT'}
    ${119} | ${129} | ${'GT'}
    ${120} | ${130} | ${'GT'}
    ${121} | ${131} | ${'GT'}
    ${122} | ${132} | ${'GT'}
    ${123} | ${133} | ${'GT'}
    ${124} | ${134} | ${'GT'}
    ${125} | ${135} | ${'GT'}
    ${126} | ${136} | ${'GT'}
    ${127} | ${137} | ${'GT'}
    ${128} | ${138} | ${'GT'}
    ${129} | ${139} | ${'GT'}
    ${130} | ${140} | ${'GT'}
    ${131} | ${141} | ${'GT'}
    ${132} | ${142} | ${'GT'}
    ${133} | ${143} | ${'GT'}
    ${134} | ${144} | ${'GT'}
    ${135} | ${145} | ${'GT'}
    ${136} | ${146} | ${'GT'}
    ${137} | ${147} | ${'GT'}
    ${138} | ${148} | ${'GT'}
    ${139} | ${149} | ${'GT'}
    ${140} | ${150} | ${'GT'}
    ${141} | ${151} | ${'GT'}
    ${142} | ${152} | ${'GT'}
    ${143} | ${153} | ${'GT'}
    ${144} | ${154} | ${'GT'}
    ${145} | ${155} | ${'GT'}
    ${146} | ${156} | ${'GT'}
    ${147} | ${157} | ${'GT'}
    ${148} | ${158} | ${'GT'}
    ${149} | ${159} | ${'GT'}
    ${150} | ${160} | ${'GT'}
    ${151} | ${161} | ${'GT'}
    ${152} | ${162} | ${'GT'}
    ${153} | ${163} | ${'GT'}
    ${154} | ${164} | ${'GT'}
    ${155} | ${165} | ${'GT'}
    ${156} | ${166} | ${'GT'}
    ${157} | ${167} | ${'GT'}
    ${158} | ${168} | ${'GT'}
    ${159} | ${169} | ${'GT'}
    ${160} | ${170} | ${'GT'}
    ${161} | ${171} | ${'GT'}
    ${162} | ${172} | ${'GT'}
    ${163} | ${173} | ${'GT'}
    ${164} | ${174} | ${'GT'}
    ${165} | ${175} | ${'GT'}
    ${166} | ${176} | ${'GT'}
    ${167} | ${177} | ${'GT'}
    ${168} | ${178} | ${'GT'}
    ${169} | ${179} | ${'GT'}
    ${170} | ${180} | ${'GT'}
    ${171} | ${181} | ${'GT'}
    ${172} | ${182} | ${'GT'}
    ${173} | ${183} | ${'GT'}
    ${174} | ${184} | ${'GT'}
    ${175} | ${185} | ${'GT'}
    ${176} | ${186} | ${'GT'}
    ${177} | ${187} | ${'GT'}
    ${178} | ${188} | ${'GT'}
    ${179} | ${189} | ${'GT'}
    ${180} | ${190} | ${'GT'}
    ${181} | ${191} | ${'GT'}
    ${182} | ${192} | ${'GT'}
    ${183} | ${193} | ${'GT'}
    ${184} | ${194} | ${'GT'}
    ${185} | ${195} | ${'GT'}
    ${186} | ${196} | ${'GT'}
    ${187} | ${197} | ${'GT'}
    ${188} | ${198} | ${'GT'}
    ${189} | ${199} | ${'GT'}
    ${190} | ${200} | ${'GT'}
    ${191} | ${201} | ${'GT'}
    ${192} | ${202} | ${'GT'}
    ${193} | ${203} | ${'GT'}
    ${194} | ${204} | ${'GT'}
    ${195} | ${205} | ${'GT'}
    ${196} | ${206} | ${'GT'}
    ${197} | ${207} | ${'GT'}
    ${198} | ${208} | ${'GT'}
    ${199} | ${209} | ${'GT'}
    ${200} | ${210} | ${'GT'}
    ${201} | ${211} | ${'GT'}
    ${202} | ${212} | ${'GT'}
    ${203} | ${213} | ${'GT'}
    ${204} | ${214} | ${'GT'}
    ${205} | ${215} | ${'GT'}
    ${206} | ${216} | ${'GT'}
    ${207} | ${217} | ${'GT'}
    ${208} | ${218} | ${'GT'}
    ${209} | ${219} | ${'GT'}
    ${210} | ${220} | ${'GT'}
    ${211} | ${221} | ${'GT'}
    ${212} | ${222} | ${'GT'}
    ${213} | ${223} | ${'GT'}
    ${214} | ${224} | ${'GT'}
    ${215} | ${225} | ${'GT'}
    ${216} | ${226} | ${'GT'}
    ${217} | ${227} | ${'GT'}
    ${218} | ${228} | ${'GT'}
    ${219} | ${229} | ${'GT'}
    ${220} | ${230} | ${'GT'}
    ${221} | ${231} | ${'GT'}
    ${222} | ${232} | ${'GT'}
    ${223} | ${233} | ${'GT'}
    ${224} | ${234} | ${'GT'}
    ${225} | ${235} | ${'GT'}
    ${226} | ${236} | ${'GT'}
    ${227} | ${237} | ${'GT'}
    ${228} | ${238} | ${'GT'}
    ${229} | ${239} | ${'GT'}
    ${230} | ${240} | ${'GT'}
    ${231} | ${241} | ${'GT'}
    ${232} | ${242} | ${'GT'}
    ${233} | ${243} | ${'GT'}
    ${234} | ${244} | ${'GT'}
    ${235} | ${245} | ${'GT'}
    ${236} | ${246} | ${'GT'}
    ${237} | ${247} | ${'GT'}
    ${238} | ${248} | ${'GT'}
    ${239} | ${249} | ${'GT'}
    ${240} | ${250} | ${'GT'}
    ${241} | ${251} | ${'GT'}
    ${242} | ${252} | ${'GT'}
    ${243} | ${253} | ${'GT'}
    ${244} | ${254} | ${'GT'}
    ${245} | ${255} | ${'GT'}
    ${246} | ${256} | ${'GT'}
    ${247} | ${257} | ${'GT'}
    ${248} | ${258} | ${'GT'}
    ${249} | ${259} | ${'GT'}
    ${250} | ${260} | ${'GT'}
    ${251} | ${261} | ${'GT'}
    ${252} | ${262} | ${'GT'}
    ${253} | ${263} | ${'GT'}
    ${254} | ${264} | ${'GT'}
    ${255} | ${265} | ${'GT'}
    ${256} | ${266} | ${'GT'}
    ${257} | ${267} | ${'GT'}
    ${258} | ${268} | ${'GT'}
    ${259} | ${269} | ${'GT'}
    ${260} | ${270} | ${'GT'}
    ${261} | ${271} | ${'GT'}
    ${262} | ${272} | ${'GT'}
    ${263} | ${273} | ${'GT'}
    ${264} | ${274} | ${'GT'}
    ${265} | ${275} | ${'GT'}
    ${266} | ${276} | ${'GT'}
    ${267} | ${277} | ${'GT'}
    ${268} | ${278} | ${'GT'}
    ${269} | ${279} | ${'GT'}
    ${270} | ${280} | ${'GT'}
    ${271} | ${281} | ${'GT'}
    ${272} | ${282} | ${'GT'}
    ${273} | ${283} | ${'GT'}
    ${274} | ${284} | ${'GT'}
    ${275} | ${285} | ${'GT'}
    ${276} | ${286} | ${'GT'}
    ${277} | ${287} | ${'GT'}
    ${278} | ${288} | ${'GT'}
    ${279} | ${289} | ${'GT'}
    ${280} | ${290} | ${'GT'}
    ${281} | ${291} | ${'GT'}
    ${282} | ${292} | ${'GT'}
    ${283} | ${293} | ${'GT'}
    ${284} | ${294} | ${'GT'}
    ${285} | ${295} | ${'GT'}
    ${286} | ${296} | ${'GT'}
    ${287} | ${297} | ${'GT'}
    ${288} | ${298} | ${'GT'}
    ${289} | ${299} | ${'GT'}
    ${290} | ${300} | ${'GT'}
    ${291} | ${301} | ${'GT'}
    ${292} | ${302} | ${'GT'}
    ${293} | ${303} | ${'GT'}
    ${294} | ${304} | ${'GT'}
    ${295} | ${305} | ${'GT'}
    ${296} | ${306} | ${'GT'}
    ${297} | ${307} | ${'GT'}
    ${298} | ${308} | ${'GT'}
    ${299} | ${309} | ${'GT'}
    ${300} | ${310} | ${'GT'}
    ${301} | ${311} | ${'GT'}
    ${302} | ${312} | ${'GT'}
    ${303} | ${313} | ${'GT'}
    ${304} | ${314} | ${'GT'}
    ${305} | ${315} | ${'GT'}
    ${306} | ${316} | ${'GT'}
    ${307} | ${317} | ${'GT'}
    ${308} | ${318} | ${'GT'}
    ${309} | ${319} | ${'GT'}
    ${310} | ${320} | ${'GT'}
    ${311} | ${321} | ${'GT'}
    ${312} | ${322} | ${'GT'}
    ${313} | ${323} | ${'GT'}
    ${314} | ${324} | ${'GT'}
    ${315} | ${325} | ${'GT'}
    ${316} | ${326} | ${'GT'}
    ${317} | ${327} | ${'GT'}
    ${318} | ${328} | ${'GT'}
    ${319} | ${329} | ${'GT'}
    ${320} | ${330} | ${'GT'}
    ${321} | ${331} | ${'GT'}
    ${322} | ${332} | ${'GT'}
    ${323} | ${333} | ${'GT'}
    ${324} | ${334} | ${'GT'}
    ${325} | ${335} | ${'GT'}
    ${326} | ${336} | ${'GT'}
    ${327} | ${337} | ${'GT'}
    ${328} | ${338} | ${'GT'}
    ${329} | ${339} | ${'GT'}
    ${330} | ${340} | ${'GT'}
    ${331} | ${341} | ${'GT'}
    ${332} | ${342} | ${'GT'}
    ${333} | ${343} | ${'GT'}
    ${334} | ${344} | ${'GT'}
    ${335} | ${345} | ${'GT'}
    ${336} | ${346} | ${'GT'}
    ${337} | ${347} | ${'GT'}
    ${338} | ${348} | ${'GT'}
    ${339} | ${349} | ${'GT'}
    ${340} | ${350} | ${'GT'}
    ${341} | ${351} | ${'GT'}
    ${342} | ${352} | ${'GT'}
    ${343} | ${353} | ${'GT'}
    ${344} | ${354} | ${'GT'}
    ${345} | ${355} | ${'GT'}
    ${346} | ${356} | ${'GT'}
    ${347} | ${357} | ${'GT'}
    ${348} | ${358} | ${'GT'}
    ${349} | ${359} | ${'GT'}
    ${350} | ${360} | ${'GT'}
    ${351} | ${361} | ${'GT'}
    ${352} | ${362} | ${'GT'}
    ${353} | ${363} | ${'GT'}
    ${354} | ${364} | ${'GT'}
    ${355} | ${365} | ${'GT'}
    ${356} | ${366} | ${'GT'}
    ${357} | ${367} | ${'LT'}
    ${358} | ${368} | ${'LT'}
    ${359} | ${369} | ${'LT'}
    ${360} | ${370} | ${'LT'}    
  `("Turns to $direction when facing $startHeading aiming for $targetHeading", ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               startHeading,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               targetHeading,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               direction
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           }) => {
        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, startHeading, 5000, 1)

        const action = new Heading({}, aeroplane, targetHeading)

        expect(aeroplane.heading).toBe(startHeading)
        action.apply()

        if (direction === "GT") {
            expect(aeroplane.heading).toBeGreaterThan(startHeading)
        } else {
            expect(aeroplane.heading).toBeLessThan(startHeading)
        }
    });

    test("Turning right within circle", () => {
        let currentHeading = 5;
        let desiredHeading = 10;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(5)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(7)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(9)
    })

    test("Turning left within circle", () => {
        let currentHeading = 10;
        let desiredHeading = 5;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(10)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(10)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(6)
    })

    test("Turning left outside circle", () => {
        let currentHeading = 5;
        let desiredHeading = 355;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(5)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(5)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(360)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(356)
        action.apply()
        expect(aeroplane.heading).toBe(355)
    })

    test("Turning right outside circle", () => {
        let currentHeading = 355;
        let desiredHeading = 5;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(355)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(356)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(0)
        action.apply()
        expect(aeroplane.heading).toBe(5)
        action.apply()
        expect(aeroplane.heading).toBe(5)
    })

    test("Defaults to right turn within circle", () => {
        let currentHeading = 90;
        let desiredHeading = 270;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(90)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(90)
    })

    test("Defaults to right turn from 0 to 180", () => {
        let currentHeading = 0;
        let desiredHeading = 180;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 220, currentHeading, 5000, 1)

        const action = new Heading({}, aeroplane, desiredHeading)

        expect(aeroplane.heading).toBe(0)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(0)
    })

    test("Is not valid if the target heading is same as current heading", () => {
        let desiredAltitude = 243;

        expect(new Heading({}, {heading: 243}, desiredAltitude).isValid()).toBeFalsy()
    })

    test("Is not valid if the target heading is less than zero", () => {
        let desiredAltitude = -1;

        expect(new Heading({}, {heading: 243}, desiredAltitude).isValid()).toBeFalsy()
    })

    test("Is not valid if the target heading is greater than 360", () => {
        let desiredAltitude = 361;

        expect(new Heading({}, {heading: 243}, desiredAltitude).isValid()).toBeFalsy()
    })

    test.each`
    weight | speed | currentHeading | targetHeadingAfterFirstApply
    ${1} | ${180} | ${90} | ${93.800}}
    ${1} | ${220} | ${90} | ${93.533}}
    ${1} | ${320} | ${90} | ${92.866}}
    ${2} | ${180} | ${90} | ${92.800}}
    ${2} | ${220} | ${90} | ${92.533}}
    ${2} | ${320} | ${90} | ${91.866}}
    ${3} | ${180} | ${90} | ${91.800}}
    ${3} | ${220} | ${90} | ${91.533}}
    ${3} | ${320} | ${90} | ${90.866}}
  `("Aeroplane with weight $weight and speed $speed heading $currentHeading should head to $targetHeadingAfterFirstApply", ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           weight,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           speed,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           currentHeading,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           targetHeadingAfterFirstApply
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       }) => {
        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, speed, currentHeading, 3000, weight)
        aeroplane.setHeading({}, 180)

        expect(aeroplane.heading).toBe(currentHeading)

        aeroplane.applyActions()

        expect(aeroplane.heading).toBeCloseTo(targetHeadingAfterFirstApply)
    })
})

describe("Altitude", () => {
    test("Creates altitude action with increasing altitude", () => {
        let currentAltitude = 1000;
        let desiredAltitude = 1100;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 200, 90, currentAltitude, 3)

        const action = new Altitude({}, aeroplane, desiredAltitude)

        expect(aeroplane.altitude).toBe(1000)
        action.apply()
        expect(aeroplane.altitude).toBe(1020)
        action.apply()
        expect(aeroplane.altitude).toBe(1040)
    })

    test("Creates altitude action with decreasing altitude", () => {
        let currentAltitude = 1100;
        let desiredAltitude = 1020;

        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 200, 90, currentAltitude, 3)

        const action = new Altitude({}, aeroplane, desiredAltitude)

        expect(aeroplane.altitude).toBe(1100)
        action.apply()
        expect(aeroplane.altitude).toBe(1080)
        action.apply()
        expect(aeroplane.altitude).toBe(1060)
    })

    test("Is not valid if the target altitude is below minimum altitude", () => {
        let desiredAltitude = MIN_ALTITUDE - 1;

        expect(new Altitude({}, {altitude: 3000}, desiredAltitude).isValid()).toBeFalsy()
    })

    test("Is not valid if the target altitude is above max altitude", () => {
        let desiredAltitude = MAX_ALTITUDE + 1;

        expect(new Altitude({}, {altitude: 3000}, desiredAltitude).isValid()).toBeFalsy()
    })

    test("Is not valid if the target altitude is same as current altitude", () => {
        let currentAltitude = 2000;

        expect(new Altitude({}, {altitude: currentAltitude}, currentAltitude).isValid()).toBeFalsy()
    })

    test("Is not valid if the target altitude is not multiple of 20", () => {
        let desiredAltitude = 2116;

        expect(new Altitude({}, {altitude: 3000}, desiredAltitude).isValid()).toBeFalsy()
    })
})

describe("Waypoint", () => {
    let map;
    beforeEach(() => {
        map = testGameMap()
    })

    test("Turns to face waypoint top right quadrant", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 200, 90, 5000, 3)

        const action = new Waypoint(map, aeroplane, "LAM")

        expect(aeroplane.heading).toBe(90)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(90)
    })

    test("Turns to face waypoint bottom right quadrant", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 300, 200, 200, 90, 5000, 3)

        const action = new Waypoint(map, aeroplane, "LAM")

        expect(aeroplane.heading).toBe(90)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(90)
    })

    test("Turns to face waypoint top left quadrant", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 600, 600, 200, 90, 5000, 3)

        const action = new Waypoint(map, aeroplane, "LAM")

        expect(aeroplane.heading).toBe(90)
        action.apply()
        expect(aeroplane.heading).toBeLessThan(90)
    })

    test("Turns to face waypoint bottom left quadrant", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 1000, 200, 200, 90, 5000, 3)

        const action = new Waypoint(map, aeroplane, "LAM")

        expect(aeroplane.heading).toBe(90)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(90)
    })

    test("Turns to face LAM from slightly North West", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 200, 800, 200, 355, 5000, 3)

        const action = new Waypoint(map, aeroplane, "LAM")

        expect(aeroplane.heading).toBe(355)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(355)
        action.apply()
        expect(aeroplane.heading).toBeGreaterThan(357)
    })

    test("Is not valid if the waypoint does not exist", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 500, 500, 200, 90, 5000, 3)
        let incorrectWaypoint = "BIP";

        expect(new Waypoint(map, aeroplane, incorrectWaypoint).isValid()).toBeFalsy()
    })

    test("Is actionable if far away from waypoint", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 100, 672, 200, 90, 5000, 3)
        let waypoint = "LAM";

        expect(new Waypoint(map, aeroplane, waypoint).isActionable()).toBeTruthy()
    })

    test("Is not actionable if close to waypoint", () => {
        const aeroplane = new Aeroplane("BA123", "A321", 495, 505, 200, 90, 5000, 3)
        let waypoint = "LAM";

        expect(new Waypoint(map, aeroplane, waypoint).isActionable()).toBeFalsy()
    })
})

describe("Landing", () => {
    let map;
    beforeEach(() => {
        map = testGameMap()
    })

    test("Applies landing sequence actions", () => {
        const correctRunway = "27R";
        const speed = 190;
        const heading = 272;
        const altitude = 2800;
        const x = 710;
        const y = 555;

        const aeroplane = new Aeroplane("BA123", "A321", x, y, speed, heading, altitude, 3)

        expect(aeroplane.actions.length).toBe(0)
        const landing = new Landing(map, aeroplane, correctRunway);
        aeroplane.addAction(landing)

        expect(aeroplane.actions.length).toBe(1)

        aeroplane.applyActions()

        expect(aeroplane.actions.length).toBe(3)
        expect(aeroplane.actions[0].type()).toBe("Landing")
        expect(aeroplane.actions[1].type()).toBe("Speed")
        expect(aeroplane.actions[2].type()).toBe("Waypoint")

        expect(aeroplane.actions[0].executed).toBeFalsy()
    })

    test("Is valid if aeroplane is in correct landing configuration", () => {
        const correctRunway = "27R";
        const speed = 190;
        const heading = 272;
        const altitude = 2800;
        const x = 710;
        const y = 555;

        const landing = new Landing(map, {
            speed: speed, heading: heading, altitude: altitude, x: x, y: y
        }, correctRunway);
        expect(landing.isValid()).toBeTruthy()
    })

    test("Is not valid if the runway does not exist", () => {
        let incorrectRunway = "66C";

        const landing = new Landing(map, {}, incorrectRunway);
        expect(landing.isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not within maximum X range of inner marker", () => {
        expect(new Landing(map, {x: 549, y: 450, heading: 90}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not outside minimum X range of inner marker", () => {
        expect(new Landing(map, {x: 601, y: 450, heading: 90}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is to the other side of the runway", () => {
        expect(new Landing(map, {x: 800, y: 450, heading: 90}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not within negative Y range of inner marker", () => {
        expect(new Landing(map, {x: 575, y: 429, heading: 90}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not within positive Y range of inner marker", () => {
        expect(new Landing(map, {x: 575, y: 471, heading: 90}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not within minimum angle of runway heading", () => {
        expect(new Landing(map, {x: 575, y: 450, heading: 101}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not below maximum altitude for runway altitude", () => {
        expect(new Landing(map, {x: 575, y: 450, heading: 90, altitude: 3001}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not above minimum altitude for runway altitude", () => {
        expect(new Landing(map, {x: 575, y: 450, heading: 90, altitude: 999}, "9L").isValid()).toBeFalsy()
    })

    test("Is not valid if the aeroplane is not below minimum approach speed", () => {
        expect(new Landing(map, {x: 575, y: 450, heading: 90, altitude: 2000, speed: 201}, "9L").isValid()).toBeFalsy()
    })
})

describe("Holding Pattern", () => {
    let map;
    beforeEach(() => {
        map = testGameMap()
    })

    test("Turns aeroplane to correct heading when turning left across 0", () => {
        const holdDirection = -1;
        const speed = 190;
        const heading = 3;
        const weight = 1;
        const x = 500;
        const y = 500;

        const aeroplane = new Aeroplane("123", "", x, y, speed, heading, 3000, weight)
        const hold = new HoldingPattern(map, aeroplane, holdDirection);

        expect(aeroplane.heading).toBe(3)

        hold.apply()

        expect(aeroplane.heading).toBeLessThanOrEqual(360)
    })

    test("Turns aeroplane to correct heading when turning right across 0", () => {
        const holdDirection = 1;
        const speed = 190;
        const heading = 358;
        const weight = 1;
        const x = 500;
        const y = 500;

        const aeroplane = new Aeroplane("123", "", x, y, speed, heading, 3000, weight)
        const hold = new HoldingPattern(map, aeroplane, holdDirection);

        expect(aeroplane.heading).toBe(358)

        hold.apply()

        expect(aeroplane.heading).toBeGreaterThanOrEqual(0)
    })

    test("Is always valid", () => {
        const hold = new HoldingPattern(map, {}, "anything");
        expect(hold.isValid()).toBeTruthy()
    })

    test("Is only actionable when flying", () => {
        const hold = new HoldingPattern(map, {isFlying: () => true}, 1);
        expect(hold.isActionable()).toBeTruthy()
    })
})

